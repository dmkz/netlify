<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Парсер боя HeroesWM</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
    }
    input[type="text"] {
      width: 80%;
      padding: 8px;
      margin-bottom: 10px;
    }
    button {
      padding: 8px 16px;
    }
    pre {
      background-color: #f4f4f4;
      padding: 15px;
      overflow: auto;
      white-space: pre-wrap;
      word-wrap: break-word;
      border: 1px solid #ccc;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>Парсер боя HeroesWM</h1>
  <p>Введите ссылку на бой:</p>
  <input type="text" id="battleLink" placeholder="https://www.heroeswm.ru/...?..." />
  <br>
  <button id="loadBtn">Загрузить!</button>
  
  <h2>Результат</h2>
  <pre id="result"></pre>
  
  <script>
    document.getElementById('loadBtn').addEventListener('click', async function() {
      const battleLink = document.getElementById('battleLink').value.trim();
      if (!battleLink) {
        alert('Пожалуйста, введите ссылку');
        return;
      }
      
      // Создаем объект URL для удобного парсинга параметров
      let url;
      try {
        url = new URL(battleLink);
      } catch(e) {
        alert('Неверный формат ссылки');
        return;
      }
      
      // Извлекаем параметры warid и show (или show_for_all)
      const params = url.searchParams;
      const warid = params.get('warid');
      let show_for_all = params.get('show_for_all') || params.get('show');
      
      if (!warid || !show_for_all) {
        alert('Невозможно найти необходимые параметры "warid" и "show_for_all" (или "show") в ссылке.');
        return;
      }
      
      // Формируем URL запроса к нашей прокси-функции
      // Если вы развернули прокси на своем домене, замените базовый URL на свой
      const proxyUrl = `/.netlify/functions/parse-battle?warid=${encodeURIComponent(warid)}&show_for_all=${encodeURIComponent(show_for_all)}`;
      
      // Отображаем результат запроса
      const resultElem = document.getElementById('result');
      resultElem.textContent = 'Загрузка...';
      
      try {
        const response = await fetch(proxyUrl);
        if (!response.ok) {
          resultElem.textContent = `Ошибка: ${response.status} ${response.statusText}`;
          return;
        }
        const html = await response.text();
        resultElem.textContent = html;
      } catch (error) {
        resultElem.textContent = 'Ошибка запроса: ' + error.toString();
      }
    });
  </script>
</body>
</html>
